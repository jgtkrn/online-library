<!doctype html>
<html class="no-js" lang="">
    <head>
        <meta charset="utf-8">
        <meta http-equiv="x-ua-compatible" content="ie=edge">
        <title>test documentation</title>
        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">

        <link rel="icon" type="image/x-icon" href="../images/favicon.ico">
	   <link rel="stylesheet" href="../styles/style.css">
        <link rel="stylesheet" href="../styles/dark.css">
    </head>
    <body>

        <div class="navbar navbar-default navbar-fixed-top visible-xs">
            <a href="../" class="navbar-brand">test documentation</a>
            <button type="button" class="btn btn-default btn-menu ion-ios-menu" id="btn-menu"></button>
        </div>

        <div class="xs-menu menu" id="mobile-menu">
                <div id="book-search-input" role="search"><input type="text" placeholder="Type to search"></div>            <compodoc-menu></compodoc-menu>
        </div>

        <div class="container-fluid main">
           <div class="row main">
               <div class="hidden-xs menu">
                   <compodoc-menu mode="normal"></compodoc-menu>
               </div>
               <!-- START CONTENT -->
               <div class="content injectable">
                   <div class="content-data">








<ol class="breadcrumb">
  <li>Injectables</li>
  <li >UsersService</li>
</ol>

<ul class="nav nav-tabs" role="tablist">
        <li class="active">
            <a href="#info" role="tab" id="info-tab" data-toggle="tab" data-link="info">Info</a>
        </li>
        <li >
            <a href="#source" role="tab" id="source-tab" data-toggle="tab" data-link="source">Source</a>
        </li>
</ul>

<div class="tab-content">
    <div class="tab-pane fade active in" id="c-info">
        <p class="comment">
            <h3>File</h3>
        </p>
        <p class="comment">
            <code>src/modules/users/users.service.ts</code>
        </p>





            <section>
    <h3 id="index">Index</h3>
    <table class="table table-sm table-bordered index-table">
        <tbody>

                <tr>
                    <td class="col-md-4">
                        <h6><b>Methods</b></h6>
                    </td>
                </tr>
                <tr>
                    <td class="col-md-4">
                        <ul class="index-list">
                            <li>
                                    <span class="modifier">Async</span>
                                <a href="#addFeedback" >addFeedback</a>
                            </li>
                            <li>
                                    <span class="modifier">Async</span>
                                <a href="#addLastLoginAt" >addLastLoginAt</a>
                            </li>
                            <li>
                                    <span class="modifier">Async</span>
                                <a href="#addUser" >addUser</a>
                            </li>
                            <li>
                                    <span class="modifier">Async</span>
                                <a href="#checkUserByReferralCode" >checkUserByReferralCode</a>
                            </li>
                            <li>
                                    <span class="modifier">Async</span>
                                <a href="#confirmPassword" >confirmPassword</a>
                            </li>
                            <li>
                                    <span class="modifier">Async</span>
                                <a href="#createNewUser" >createNewUser</a>
                            </li>
                            <li>
                                    <span class="modifier">Async</span>
                                <a href="#exportCsv" >exportCsv</a>
                            </li>
                            <li>
                                    <span class="modifier">Async</span>
                                <a href="#findOne" >findOne</a>
                            </li>
                            <li>
                                    <span class="modifier">Async</span>
                                <a href="#forgetPassword" >forgetPassword</a>
                            </li>
                            <li>
                                    <span class="modifier">Async</span>
                                <a href="#generateReferralCode" >generateReferralCode</a>
                            </li>
                            <li>
                                    <span class="modifier">Async</span>
                                <a href="#getExportDataUser" >getExportDataUser</a>
                            </li>
                            <li>
                                    <span class="modifier">Async</span>
                                <a href="#getInterestByUserLabel" >getInterestByUserLabel</a>
                            </li>
                            <li>
                                    <span class="modifier">Async</span>
                                <a href="#getPaidPaymentByUser" >getPaidPaymentByUser</a>
                            </li>
                            <li>
                                <a href="#getUser" >getUser</a>
                            </li>
                            <li>
                                    <span class="modifier">Async</span>
                                <a href="#getUserByReferralCode" >getUserByReferralCode</a>
                            </li>
                            <li>
                                    <span class="modifier">Async</span>
                                <a href="#getUserWithSubscription" >getUserWithSubscription</a>
                            </li>
                            <li>
                                    <span class="modifier">Async</span>
                                <a href="#isFreeTrialClaimed" >isFreeTrialClaimed</a>
                            </li>
                            <li>
                                    <span class="modifier">Async</span>
                                <a href="#isReferralCodeAvailabe" >isReferralCodeAvailabe</a>
                            </li>
                            <li>
                                    <span class="modifier">Async</span>
                                <a href="#isReferralCodeClaimed" >isReferralCodeClaimed</a>
                            </li>
                            <li>
                                    <span class="modifier">Async</span>
                                <a href="#isUserUniqueValidationPassed" >isUserUniqueValidationPassed</a>
                            </li>
                            <li>
                                    <span class="modifier">Async</span>
                                <a href="#resetPassword" >resetPassword</a>
                            </li>
                            <li>
                                    <span class="modifier">Async</span>
                                <a href="#updateAppleId" >updateAppleId</a>
                            </li>
                            <li>
                                    <span class="modifier">Async</span>
                                <a href="#updateFreeTrial" >updateFreeTrial</a>
                            </li>
                            <li>
                                    <span class="modifier">Async</span>
                                <a href="#updateMemberType" >updateMemberType</a>
                            </li>
                            <li>
                                    <span class="modifier">Async</span>
                                <a href="#updatePassWord" >updatePassWord</a>
                            </li>
                            <li>
                                    <span class="modifier">Async</span>
                                <a href="#updateReferralCodeStatus" >updateReferralCodeStatus</a>
                            </li>
                            <li>
                                    <span class="modifier">Async</span>
                                <a href="#updateStripeId" >updateStripeId</a>
                            </li>
                            <li>
                                    <span class="modifier">Async</span>
                                <a href="#updateUser" >updateUser</a>
                            </li>
                            <li>
                                    <span class="modifier">Async</span>
                                <a href="#verifyToken" >verifyToken</a>
                            </li>
                        </ul>
                    </td>
                </tr>





        </tbody>
    </table>
</section>

            <section>
    <h3 id="constructor">Constructor</h3>
        <table class="table table-sm table-bordered">
            <tbody>
                <tr>
                    <td class="col-md-4">
<code>constructor(response: <a href="../injectables/Response.html" target="_self">Response</a>, emailSender: <a href="../classes/EmailSender.html" target="_self">EmailSender</a>, i18n: I18nService, exportFile: <a href="../classes/ExportFile.html" target="_self">ExportFile</a>, userRepository: <a href="../interfaces/User.html" target="_self">Repository&lt;UserEntity&gt;</a>, authEntityRepository: <a href="../entitys/AuthEntity.html" target="_self">Repository&lt;AuthEntity&gt;</a>, userInterestRepository: <a href="../interfaces/User.html" target="_self">Repository&lt;UserInterestEntity&gt;</a>, userPaymentRepository: <a href="../interfaces/User.html" target="_self">Repository&lt;UserPaymentEntity&gt;</a>)</code>
                    </td>
                </tr>
                        <tr>
                            <td class="col-md-4">
                                <div class="io-line">Defined in <a href="" data-line="26" class="link-to-prism">src/modules/users/users.service.ts:26</a></div>
                            </td>
                        </tr>

                <tr>
                    <td class="col-md-4">
                            <div>
                                    <b>Parameters :</b>
                                    <table class="params">
                                        <thead>
                                            <tr>
                                                <td>Name</td>
                                                    <td>Type</td>
                                                <td>Optional</td>
                                            </tr>
                                        </thead>
                                        <tbody>
                                                <tr>
                                                        <td>response</td>
                                                  
                                                        <td>
                                                                        <code><a href="../injectables/Response.html" target="_self" >Response</a></code>
                                                        </td>
                                                  
                                                    <td>
                                                            No
                                                    </td>
                                                    
                                                </tr>
                                                <tr>
                                                        <td>emailSender</td>
                                                  
                                                        <td>
                                                                        <code><a href="../classes/EmailSender.html" target="_self" >EmailSender</a></code>
                                                        </td>
                                                  
                                                    <td>
                                                            No
                                                    </td>
                                                    
                                                </tr>
                                                <tr>
                                                        <td>i18n</td>
                                                  
                                                        <td>
                                                                    <code>I18nService</code>
                                                        </td>
                                                  
                                                    <td>
                                                            No
                                                    </td>
                                                    
                                                </tr>
                                                <tr>
                                                        <td>exportFile</td>
                                                  
                                                        <td>
                                                                        <code><a href="../classes/ExportFile.html" target="_self" >ExportFile</a></code>
                                                        </td>
                                                  
                                                    <td>
                                                            No
                                                    </td>
                                                    
                                                </tr>
                                                <tr>
                                                        <td>userRepository</td>
                                                  
                                                        <td>
                                                                        <code><a href="../interfaces/User.html" target="_self" >Repository&lt;UserEntity&gt;</a></code>
                                                        </td>
                                                  
                                                    <td>
                                                            No
                                                    </td>
                                                    
                                                </tr>
                                                <tr>
                                                        <td>authEntityRepository</td>
                                                  
                                                        <td>
                                                                        <code><a href="../entitys/AuthEntity.html" target="_self" >Repository&lt;AuthEntity&gt;</a></code>
                                                        </td>
                                                  
                                                    <td>
                                                            No
                                                    </td>
                                                    
                                                </tr>
                                                <tr>
                                                        <td>userInterestRepository</td>
                                                  
                                                        <td>
                                                                        <code><a href="../interfaces/User.html" target="_self" >Repository&lt;UserInterestEntity&gt;</a></code>
                                                        </td>
                                                  
                                                    <td>
                                                            No
                                                    </td>
                                                    
                                                </tr>
                                                <tr>
                                                        <td>userPaymentRepository</td>
                                                  
                                                        <td>
                                                                        <code><a href="../interfaces/User.html" target="_self" >Repository&lt;UserPaymentEntity&gt;</a></code>
                                                        </td>
                                                  
                                                    <td>
                                                            No
                                                    </td>
                                                    
                                                </tr>
                                        </tbody>
                                    </table>
                            </div>
                    </td>
                </tr>
            </tbody>
        </table>
</section>

            <section>
    
    <h3 id="methods">
        Methods
    </h3>
    <table class="table table-sm table-bordered">
        <tbody>
            <tr>
                <td class="col-md-4">
                    <a name="addFeedback"></a>
                    <span class="name">
                        <span class="modifier">Async</span>
                        <span ><b>addFeedback</b></span>
                        <a href="#addFeedback"><span class="icon ion-ios-link"></span></a>
                    </span>
                </td>
            </tr>
            <tr>
                <td class="col-md-4">
                    <span class="modifier-icon icon ion-ios-reset"></span>
                    <code>addFeedback(userId: <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/string" target="_blank">string</a>, description: <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/string" target="_blank">string</a>)</code>
                </td>
            </tr>


            <tr>
                <td class="col-md-4">
                    <div class="io-line">Defined in <a href="" data-line="562"
                            class="link-to-prism">src/modules/users/users.service.ts:562</a></div>
                </td>
            </tr>


            <tr>
                <td class="col-md-4">

                    <div class="io-description">
                        <b>Parameters :</b>
                        
                        <table class="params">
                            <thead>
                                <tr>
                                    <td>Name</td>
                                    <td>Type</td>
                                    <td>Optional</td>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td>userId</td>
                                    <td>
                                                <code><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/string" target="_blank" >string</a></code>
                                    </td>

                                    <td>
                                        No
                                    </td>


                                </tr>
                                <tr>
                                    <td>description</td>
                                    <td>
                                                <code><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/string" target="_blank" >string</a></code>
                                    </td>

                                    <td>
                                        No
                                    </td>


                                </tr>
                            </tbody>
                        </table>
                    </div>
                    <div>
                    </div>
                    <div class="io-description">
                        <b>Returns : </b>        <code><a href="https://www.typescriptlang.org/docs/handbook/basic-types.html" target="_blank" >any</a></code>

                    </div>
                    <div class="io-description">
                        
                    </div>
                </td>
            </tr>
        </tbody>
    </table>
    <table class="table table-sm table-bordered">
        <tbody>
            <tr>
                <td class="col-md-4">
                    <a name="addLastLoginAt"></a>
                    <span class="name">
                        <span class="modifier">Async</span>
                        <span ><b>addLastLoginAt</b></span>
                        <a href="#addLastLoginAt"><span class="icon ion-ios-link"></span></a>
                    </span>
                </td>
            </tr>
            <tr>
                <td class="col-md-4">
                    <span class="modifier-icon icon ion-ios-reset"></span>
                    <code>addLastLoginAt(id)</code>
                </td>
            </tr>


            <tr>
                <td class="col-md-4">
                    <div class="io-line">Defined in <a href="" data-line="302"
                            class="link-to-prism">src/modules/users/users.service.ts:302</a></div>
                </td>
            </tr>


            <tr>
                <td class="col-md-4">

                    <div class="io-description">
                        <b>Parameters :</b>
                        
                        <table class="params">
                            <thead>
                                <tr>
                                    <td>Name</td>
                                    <td>Optional</td>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td>id</td>

                                    <td>
                                        No
                                    </td>


                                </tr>
                            </tbody>
                        </table>
                    </div>
                    <div>
                    </div>
                    <div class="io-description">
                        <b>Returns : </b>    <code>Promise&lt;void&gt;</code>

                    </div>
                    <div class="io-description">
                        
                    </div>
                </td>
            </tr>
        </tbody>
    </table>
    <table class="table table-sm table-bordered">
        <tbody>
            <tr>
                <td class="col-md-4">
                    <a name="addUser"></a>
                    <span class="name">
                        <span class="modifier">Async</span>
                        <span ><b>addUser</b></span>
                        <a href="#addUser"><span class="icon ion-ios-link"></span></a>
                    </span>
                </td>
            </tr>
            <tr>
                <td class="col-md-4">
                    <span class="modifier-icon icon ion-ios-reset"></span>
                    <code>addUser(user, socialLogin: null, registration_platform: null)</code>
                </td>
            </tr>


            <tr>
                <td class="col-md-4">
                    <div class="io-line">Defined in <a href="" data-line="89"
                            class="link-to-prism">src/modules/users/users.service.ts:89</a></div>
                </td>
            </tr>


            <tr>
                <td class="col-md-4">

                    <div class="io-description">
                        <b>Parameters :</b>
                        
                        <table class="params">
                            <thead>
                                <tr>
                                    <td>Name</td>
                                    <td>Type</td>
                                    <td>Optional</td>
                                    <td>Default value</td>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td>user</td>
                                    <td>
                                    </td>

                                    <td>
                                        No
                                    </td>

                                    <td>
                                    </td>

                                </tr>
                                <tr>
                                    <td>socialLogin</td>
                                    <td>
                                            <code>null</code>
                                    </td>

                                    <td>
                                        No
                                    </td>

                                    <td>
                                        <code>null</code>
                                    </td>

                                </tr>
                                <tr>
                                    <td>registration_platform</td>
                                    <td>
                                            <code>null</code>
                                    </td>

                                    <td>
                                        No
                                    </td>

                                    <td>
                                        <code>null</code>
                                    </td>

                                </tr>
                            </tbody>
                        </table>
                    </div>
                    <div>
                    </div>
                    <div class="io-description">
                        <b>Returns : </b>    <code>Promise&lt;void&gt;</code>

                    </div>
                    <div class="io-description">
                        
                    </div>
                </td>
            </tr>
        </tbody>
    </table>
    <table class="table table-sm table-bordered">
        <tbody>
            <tr>
                <td class="col-md-4">
                    <a name="checkUserByReferralCode"></a>
                    <span class="name">
                        <span class="modifier">Async</span>
                        <span ><b>checkUserByReferralCode</b></span>
                        <a href="#checkUserByReferralCode"><span class="icon ion-ios-link"></span></a>
                    </span>
                </td>
            </tr>
            <tr>
                <td class="col-md-4">
                    <span class="modifier-icon icon ion-ios-reset"></span>
                    <code>checkUserByReferralCode(referral_code: <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/string" target="_blank">string</a>, userId: <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/string" target="_blank">string</a>)</code>
                </td>
            </tr>


            <tr>
                <td class="col-md-4">
                    <div class="io-line">Defined in <a href="" data-line="803"
                            class="link-to-prism">src/modules/users/users.service.ts:803</a></div>
                </td>
            </tr>


            <tr>
                <td class="col-md-4">

                    <div class="io-description">
                        <b>Parameters :</b>
                        
                        <table class="params">
                            <thead>
                                <tr>
                                    <td>Name</td>
                                    <td>Type</td>
                                    <td>Optional</td>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td>referral_code</td>
                                    <td>
                                                <code><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/string" target="_blank" >string</a></code>
                                    </td>

                                    <td>
                                        No
                                    </td>


                                </tr>
                                <tr>
                                    <td>userId</td>
                                    <td>
                                                <code><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/string" target="_blank" >string</a></code>
                                    </td>

                                    <td>
                                        No
                                    </td>


                                </tr>
                            </tbody>
                        </table>
                    </div>
                    <div>
                    </div>
                    <div class="io-description">
                        <b>Returns : </b>    <code>Promise&lt;Object&gt;</code>

                    </div>
                    <div class="io-description">
                        
                    </div>
                </td>
            </tr>
        </tbody>
    </table>
    <table class="table table-sm table-bordered">
        <tbody>
            <tr>
                <td class="col-md-4">
                    <a name="confirmPassword"></a>
                    <span class="name">
                        <span class="modifier">Async</span>
                        <span ><b>confirmPassword</b></span>
                        <a href="#confirmPassword"><span class="icon ion-ios-link"></span></a>
                    </span>
                </td>
            </tr>
            <tr>
                <td class="col-md-4">
                    <span class="modifier-icon icon ion-ios-reset"></span>
                    <code>confirmPassword(userData)</code>
                </td>
            </tr>


            <tr>
                <td class="col-md-4">
                    <div class="io-line">Defined in <a href="" data-line="336"
                            class="link-to-prism">src/modules/users/users.service.ts:336</a></div>
                </td>
            </tr>


            <tr>
                <td class="col-md-4">

                    <div class="io-description">
                        <b>Parameters :</b>
                        
                        <table class="params">
                            <thead>
                                <tr>
                                    <td>Name</td>
                                    <td>Optional</td>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td>userData</td>

                                    <td>
                                        No
                                    </td>


                                </tr>
                            </tbody>
                        </table>
                    </div>
                    <div>
                    </div>
                    <div class="io-description">
                        <b>Returns : </b>    <code>Promise&lt;void&gt;</code>

                    </div>
                    <div class="io-description">
                        
                    </div>
                </td>
            </tr>
        </tbody>
    </table>
    <table class="table table-sm table-bordered">
        <tbody>
            <tr>
                <td class="col-md-4">
                    <a name="createNewUser"></a>
                    <span class="name">
                        <span class="modifier">Async</span>
                        <span ><b>createNewUser</b></span>
                        <a href="#createNewUser"><span class="icon ion-ios-link"></span></a>
                    </span>
                </td>
            </tr>
            <tr>
                <td class="col-md-4">
                    <span class="modifier-icon icon ion-ios-reset"></span>
                    <code>createNewUser(userData)</code>
                </td>
            </tr>


            <tr>
                <td class="col-md-4">
                    <div class="io-line">Defined in <a href="" data-line="193"
                            class="link-to-prism">src/modules/users/users.service.ts:193</a></div>
                </td>
            </tr>


            <tr>
                <td class="col-md-4">

                    <div class="io-description">
                        <b>Parameters :</b>
                        
                        <table class="params">
                            <thead>
                                <tr>
                                    <td>Name</td>
                                    <td>Optional</td>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td>userData</td>

                                    <td>
                                        No
                                    </td>


                                </tr>
                            </tbody>
                        </table>
                    </div>
                    <div>
                    </div>
                    <div class="io-description">
                        <b>Returns : </b>    <code>Promise&lt;void&gt;</code>

                    </div>
                    <div class="io-description">
                        
                    </div>
                </td>
            </tr>
        </tbody>
    </table>
    <table class="table table-sm table-bordered">
        <tbody>
            <tr>
                <td class="col-md-4">
                    <a name="exportCsv"></a>
                    <span class="name">
                        <span class="modifier">Async</span>
                        <span ><b>exportCsv</b></span>
                        <a href="#exportCsv"><span class="icon ion-ios-link"></span></a>
                    </span>
                </td>
            </tr>
            <tr>
                <td class="col-md-4">
                    <span class="modifier-icon icon ion-ios-reset"></span>
                    <code>exportCsv(res)</code>
                </td>
            </tr>


            <tr>
                <td class="col-md-4">
                    <div class="io-line">Defined in <a href="" data-line="682"
                            class="link-to-prism">src/modules/users/users.service.ts:682</a></div>
                </td>
            </tr>


            <tr>
                <td class="col-md-4">

                    <div class="io-description">
                        <b>Parameters :</b>
                        
                        <table class="params">
                            <thead>
                                <tr>
                                    <td>Name</td>
                                    <td>Optional</td>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td>res</td>

                                    <td>
                                        No
                                    </td>


                                </tr>
                            </tbody>
                        </table>
                    </div>
                    <div>
                    </div>
                    <div class="io-description">
                        <b>Returns : </b>    <code>unknown</code>

                    </div>
                    <div class="io-description">
                        
                    </div>
                </td>
            </tr>
        </tbody>
    </table>
    <table class="table table-sm table-bordered">
        <tbody>
            <tr>
                <td class="col-md-4">
                    <a name="findOne"></a>
                    <span class="name">
                        <span class="modifier">Async</span>
                        <span ><b>findOne</b></span>
                        <a href="#findOne"><span class="icon ion-ios-link"></span></a>
                    </span>
                </td>
            </tr>
            <tr>
                <td class="col-md-4">
                    <span class="modifier-icon icon ion-ios-reset"></span>
                    <code>findOne(id, email)</code>
                </td>
            </tr>


            <tr>
                <td class="col-md-4">
                    <div class="io-line">Defined in <a href="" data-line="84"
                            class="link-to-prism">src/modules/users/users.service.ts:84</a></div>
                </td>
            </tr>


            <tr>
                <td class="col-md-4">

                    <div class="io-description">
                        <b>Parameters :</b>
                        
                        <table class="params">
                            <thead>
                                <tr>
                                    <td>Name</td>
                                    <td>Optional</td>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td>id</td>

                                    <td>
                                        No
                                    </td>


                                </tr>
                                <tr>
                                    <td>email</td>

                                    <td>
                                        No
                                    </td>


                                </tr>
                            </tbody>
                        </table>
                    </div>
                    <div>
                    </div>
                    <div class="io-description">
                        <b>Returns : </b>        <code><a href="../interfaces/User.html" target="_self" >Promise&lt;User&gt;</a></code>

                    </div>
                    <div class="io-description">
                        
                    </div>
                </td>
            </tr>
        </tbody>
    </table>
    <table class="table table-sm table-bordered">
        <tbody>
            <tr>
                <td class="col-md-4">
                    <a name="forgetPassword"></a>
                    <span class="name">
                        <span class="modifier">Async</span>
                        <span ><b>forgetPassword</b></span>
                        <a href="#forgetPassword"><span class="icon ion-ios-link"></span></a>
                    </span>
                </td>
            </tr>
            <tr>
                <td class="col-md-4">
                    <span class="modifier-icon icon ion-ios-reset"></span>
                    <code>forgetPassword(userData)</code>
                </td>
            </tr>


            <tr>
                <td class="col-md-4">
                    <div class="io-line">Defined in <a href="" data-line="253"
                            class="link-to-prism">src/modules/users/users.service.ts:253</a></div>
                </td>
            </tr>


            <tr>
                <td class="col-md-4">

                    <div class="io-description">
                        <b>Parameters :</b>
                        
                        <table class="params">
                            <thead>
                                <tr>
                                    <td>Name</td>
                                    <td>Optional</td>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td>userData</td>

                                    <td>
                                        No
                                    </td>


                                </tr>
                            </tbody>
                        </table>
                    </div>
                    <div>
                    </div>
                    <div class="io-description">
                        <b>Returns : </b>        <code><a href="https://www.typescriptlang.org/docs/handbook/basic-types.html" target="_blank" >any</a></code>

                    </div>
                    <div class="io-description">
                        
                    </div>
                </td>
            </tr>
        </tbody>
    </table>
    <table class="table table-sm table-bordered">
        <tbody>
            <tr>
                <td class="col-md-4">
                    <a name="generateReferralCode"></a>
                    <span class="name">
                        <span class="modifier">Async</span>
                        <span ><b>generateReferralCode</b></span>
                        <a href="#generateReferralCode"><span class="icon ion-ios-link"></span></a>
                    </span>
                </td>
            </tr>
            <tr>
                <td class="col-md-4">
                    <span class="modifier-icon icon ion-ios-reset"></span>
                    <code>generateReferralCode(check)</code>
                </td>
            </tr>


            <tr>
                <td class="col-md-4">
                    <div class="io-line">Defined in <a href="" data-line="769"
                            class="link-to-prism">src/modules/users/users.service.ts:769</a></div>
                </td>
            </tr>


            <tr>
                <td class="col-md-4">

                    <div class="io-description">
                        <b>Parameters :</b>
                        
                        <table class="params">
                            <thead>
                                <tr>
                                    <td>Name</td>
                                    <td>Optional</td>
                                    <td>Default value</td>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td>check</td>

                                    <td>
                                        No
                                    </td>

                                    <td>
                                        <code>true</code>
                                    </td>

                                </tr>
                            </tbody>
                        </table>
                    </div>
                    <div>
                    </div>
                    <div class="io-description">
                        <b>Returns : </b>    <code>Promise&lt;string&gt;</code>

                    </div>
                    <div class="io-description">
                        
                    </div>
                </td>
            </tr>
        </tbody>
    </table>
    <table class="table table-sm table-bordered">
        <tbody>
            <tr>
                <td class="col-md-4">
                    <a name="getExportDataUser"></a>
                    <span class="name">
                        <span class="modifier">Async</span>
                        <span ><b>getExportDataUser</b></span>
                        <a href="#getExportDataUser"><span class="icon ion-ios-link"></span></a>
                    </span>
                </td>
            </tr>
            <tr>
                <td class="col-md-4">
                    <span class="modifier-icon icon ion-ios-reset"></span>
                    <code>getExportDataUser()</code>
                </td>
            </tr>


            <tr>
                <td class="col-md-4">
                    <div class="io-line">Defined in <a href="" data-line="599"
                            class="link-to-prism">src/modules/users/users.service.ts:599</a></div>
                </td>
            </tr>


            <tr>
                <td class="col-md-4">

                    <div class="io-description">
                        <b>Returns : </b>    <code>Promise&lt;Object&gt;</code>

                    </div>
                </td>
            </tr>
        </tbody>
    </table>
    <table class="table table-sm table-bordered">
        <tbody>
            <tr>
                <td class="col-md-4">
                    <a name="getInterestByUserLabel"></a>
                    <span class="name">
                        <span class="modifier">Async</span>
                        <span ><b>getInterestByUserLabel</b></span>
                        <a href="#getInterestByUserLabel"><span class="icon ion-ios-link"></span></a>
                    </span>
                </td>
            </tr>
            <tr>
                <td class="col-md-4">
                    <span class="modifier-icon icon ion-ios-reset"></span>
                    <code>getInterestByUserLabel(user_label)</code>
                </td>
            </tr>


            <tr>
                <td class="col-md-4">
                    <div class="io-line">Defined in <a href="" data-line="582"
                            class="link-to-prism">src/modules/users/users.service.ts:582</a></div>
                </td>
            </tr>


            <tr>
                <td class="col-md-4">

                    <div class="io-description">
                        <b>Parameters :</b>
                        
                        <table class="params">
                            <thead>
                                <tr>
                                    <td>Name</td>
                                    <td>Optional</td>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td>user_label</td>

                                    <td>
                                        No
                                    </td>


                                </tr>
                            </tbody>
                        </table>
                    </div>
                    <div>
                    </div>
                    <div class="io-description">
                        <b>Returns : </b>    <code>Promise&lt;Object&gt;</code>

                    </div>
                    <div class="io-description">
                        
                    </div>
                </td>
            </tr>
        </tbody>
    </table>
    <table class="table table-sm table-bordered">
        <tbody>
            <tr>
                <td class="col-md-4">
                    <a name="getPaidPaymentByUser"></a>
                    <span class="name">
                        <span class="modifier">Async</span>
                        <span ><b>getPaidPaymentByUser</b></span>
                        <a href="#getPaidPaymentByUser"><span class="icon ion-ios-link"></span></a>
                    </span>
                </td>
            </tr>
            <tr>
                <td class="col-md-4">
                    <span class="modifier-icon icon ion-ios-reset"></span>
                    <code>getPaidPaymentByUser(user_id: <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/string" target="_blank">string</a>)</code>
                </td>
            </tr>


            <tr>
                <td class="col-md-4">
                    <div class="io-line">Defined in <a href="" data-line="844"
                            class="link-to-prism">src/modules/users/users.service.ts:844</a></div>
                </td>
            </tr>


            <tr>
                <td class="col-md-4">

                    <div class="io-description">
                        <b>Parameters :</b>
                        
                        <table class="params">
                            <thead>
                                <tr>
                                    <td>Name</td>
                                    <td>Type</td>
                                    <td>Optional</td>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td>user_id</td>
                                    <td>
                                                <code><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/string" target="_blank" >string</a></code>
                                    </td>

                                    <td>
                                        No
                                    </td>


                                </tr>
                            </tbody>
                        </table>
                    </div>
                    <div>
                    </div>
                    <div class="io-description">
                        <b>Returns : </b>    <code>Promise&lt;any&gt;</code>

                    </div>
                    <div class="io-description">
                        
                    </div>
                </td>
            </tr>
        </tbody>
    </table>
    <table class="table table-sm table-bordered">
        <tbody>
            <tr>
                <td class="col-md-4">
                    <a name="getUser"></a>
                    <span class="name">
                        <span ><b>getUser</b></span>
                        <a href="#getUser"><span class="icon ion-ios-link"></span></a>
                    </span>
                </td>
            </tr>
            <tr>
                <td class="col-md-4">
<code>getUser(id, email, additionalSelect: null, appleId: null)</code>
                </td>
            </tr>


            <tr>
                <td class="col-md-4">
                    <div class="io-line">Defined in <a href="" data-line="48"
                            class="link-to-prism">src/modules/users/users.service.ts:48</a></div>
                </td>
            </tr>


            <tr>
                <td class="col-md-4">

                    <div class="io-description">
                        <b>Parameters :</b>
                        
                        <table class="params">
                            <thead>
                                <tr>
                                    <td>Name</td>
                                    <td>Type</td>
                                    <td>Optional</td>
                                    <td>Default value</td>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td>id</td>
                                    <td>
                                    </td>

                                    <td>
                                        No
                                    </td>

                                    <td>
                                    </td>

                                </tr>
                                <tr>
                                    <td>email</td>
                                    <td>
                                    </td>

                                    <td>
                                        No
                                    </td>

                                    <td>
                                    </td>

                                </tr>
                                <tr>
                                    <td>additionalSelect</td>
                                    <td>
                                            <code>null</code>
                                    </td>

                                    <td>
                                        No
                                    </td>

                                    <td>
                                        <code>null</code>
                                    </td>

                                </tr>
                                <tr>
                                    <td>appleId</td>
                                    <td>
                                            <code>null</code>
                                    </td>

                                    <td>
                                        No
                                    </td>

                                    <td>
                                        <code>null</code>
                                    </td>

                                </tr>
                            </tbody>
                        </table>
                    </div>
                    <div>
                    </div>
                    <div class="io-description">
                        <b>Returns : </b>        <code><a href="https://www.typescriptlang.org/docs/handbook/basic-types.html" target="_blank" >any</a></code>

                    </div>
                    <div class="io-description">
                        
                    </div>
                </td>
            </tr>
        </tbody>
    </table>
    <table class="table table-sm table-bordered">
        <tbody>
            <tr>
                <td class="col-md-4">
                    <a name="getUserByReferralCode"></a>
                    <span class="name">
                        <span class="modifier">Async</span>
                        <span ><b>getUserByReferralCode</b></span>
                        <a href="#getUserByReferralCode"><span class="icon ion-ios-link"></span></a>
                    </span>
                </td>
            </tr>
            <tr>
                <td class="col-md-4">
                    <span class="modifier-icon icon ion-ios-reset"></span>
                    <code>getUserByReferralCode(referral_code: <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/string" target="_blank">string</a>)</code>
                </td>
            </tr>


            <tr>
                <td class="col-md-4">
                    <div class="io-line">Defined in <a href="" data-line="435"
                            class="link-to-prism">src/modules/users/users.service.ts:435</a></div>
                </td>
            </tr>


            <tr>
                <td class="col-md-4">

                    <div class="io-description">
                        <b>Parameters :</b>
                        
                        <table class="params">
                            <thead>
                                <tr>
                                    <td>Name</td>
                                    <td>Type</td>
                                    <td>Optional</td>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td>referral_code</td>
                                    <td>
                                                <code><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/string" target="_blank" >string</a></code>
                                    </td>

                                    <td>
                                        No
                                    </td>


                                </tr>
                            </tbody>
                        </table>
                    </div>
                    <div>
                    </div>
                    <div class="io-description">
                        <b>Returns : </b>    <code>Promise&lt;Object&gt;</code>

                    </div>
                    <div class="io-description">
                        
                    </div>
                </td>
            </tr>
        </tbody>
    </table>
    <table class="table table-sm table-bordered">
        <tbody>
            <tr>
                <td class="col-md-4">
                    <a name="getUserWithSubscription"></a>
                    <span class="name">
                        <span class="modifier">Async</span>
                        <span ><b>getUserWithSubscription</b></span>
                        <a href="#getUserWithSubscription"><span class="icon ion-ios-link"></span></a>
                    </span>
                </td>
            </tr>
            <tr>
                <td class="col-md-4">
                    <span class="modifier-icon icon ion-ios-reset"></span>
                    <code>getUserWithSubscription(userId, additionalSelect: null)</code>
                </td>
            </tr>


            <tr>
                <td class="col-md-4">
                    <div class="io-line">Defined in <a href="" data-line="492"
                            class="link-to-prism">src/modules/users/users.service.ts:492</a></div>
                </td>
            </tr>


            <tr>
                <td class="col-md-4">

                    <div class="io-description">
                        <b>Parameters :</b>
                        
                        <table class="params">
                            <thead>
                                <tr>
                                    <td>Name</td>
                                    <td>Type</td>
                                    <td>Optional</td>
                                    <td>Default value</td>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td>userId</td>
                                    <td>
                                    </td>

                                    <td>
                                        No
                                    </td>

                                    <td>
                                    </td>

                                </tr>
                                <tr>
                                    <td>additionalSelect</td>
                                    <td>
                                            <code>null</code>
                                    </td>

                                    <td>
                                        No
                                    </td>

                                    <td>
                                        <code>null</code>
                                    </td>

                                </tr>
                            </tbody>
                        </table>
                    </div>
                    <div>
                    </div>
                    <div class="io-description">
                        <b>Returns : </b>    <code>Promise&lt;Object&gt;</code>

                    </div>
                    <div class="io-description">
                        
                    </div>
                </td>
            </tr>
        </tbody>
    </table>
    <table class="table table-sm table-bordered">
        <tbody>
            <tr>
                <td class="col-md-4">
                    <a name="isFreeTrialClaimed"></a>
                    <span class="name">
                        <span class="modifier">Async</span>
                        <span ><b>isFreeTrialClaimed</b></span>
                        <a href="#isFreeTrialClaimed"><span class="icon ion-ios-link"></span></a>
                    </span>
                </td>
            </tr>
            <tr>
                <td class="col-md-4">
                    <span class="modifier-icon icon ion-ios-reset"></span>
                    <code>isFreeTrialClaimed(userId: <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/string" target="_blank">string</a>)</code>
                </td>
            </tr>


            <tr>
                <td class="col-md-4">
                    <div class="io-line">Defined in <a href="" data-line="388"
                            class="link-to-prism">src/modules/users/users.service.ts:388</a></div>
                </td>
            </tr>


            <tr>
                <td class="col-md-4">

                    <div class="io-description">
                        <b>Parameters :</b>
                        
                        <table class="params">
                            <thead>
                                <tr>
                                    <td>Name</td>
                                    <td>Type</td>
                                    <td>Optional</td>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td>userId</td>
                                    <td>
                                                <code><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/string" target="_blank" >string</a></code>
                                    </td>

                                    <td>
                                        No
                                    </td>


                                </tr>
                            </tbody>
                        </table>
                    </div>
                    <div>
                    </div>
                    <div class="io-description">
                        <b>Returns : </b>    <code>Promise&lt;boolean&gt;</code>

                    </div>
                    <div class="io-description">
                        
                    </div>
                </td>
            </tr>
        </tbody>
    </table>
    <table class="table table-sm table-bordered">
        <tbody>
            <tr>
                <td class="col-md-4">
                    <a name="isReferralCodeAvailabe"></a>
                    <span class="name">
                        <span class="modifier">Async</span>
                        <span ><b>isReferralCodeAvailabe</b></span>
                        <a href="#isReferralCodeAvailabe"><span class="icon ion-ios-link"></span></a>
                    </span>
                </td>
            </tr>
            <tr>
                <td class="col-md-4">
                    <span class="modifier-icon icon ion-ios-reset"></span>
                    <code>isReferralCodeAvailabe(code: <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/string" target="_blank">string</a>)</code>
                </td>
            </tr>


            <tr>
                <td class="col-md-4">
                    <div class="io-line">Defined in <a href="" data-line="788"
                            class="link-to-prism">src/modules/users/users.service.ts:788</a></div>
                </td>
            </tr>


            <tr>
                <td class="col-md-4">

                    <div class="io-description">
                        <b>Parameters :</b>
                        
                        <table class="params">
                            <thead>
                                <tr>
                                    <td>Name</td>
                                    <td>Type</td>
                                    <td>Optional</td>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td>code</td>
                                    <td>
                                                <code><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/string" target="_blank" >string</a></code>
                                    </td>

                                    <td>
                                        No
                                    </td>


                                </tr>
                            </tbody>
                        </table>
                    </div>
                    <div>
                    </div>
                    <div class="io-description">
                        <b>Returns : </b>    <code>Promise&lt;boolean&gt;</code>

                    </div>
                    <div class="io-description">
                        
                    </div>
                </td>
            </tr>
        </tbody>
    </table>
    <table class="table table-sm table-bordered">
        <tbody>
            <tr>
                <td class="col-md-4">
                    <a name="isReferralCodeClaimed"></a>
                    <span class="name">
                        <span class="modifier">Async</span>
                        <span ><b>isReferralCodeClaimed</b></span>
                        <a href="#isReferralCodeClaimed"><span class="icon ion-ios-link"></span></a>
                    </span>
                </td>
            </tr>
            <tr>
                <td class="col-md-4">
                    <span class="modifier-icon icon ion-ios-reset"></span>
                    <code>isReferralCodeClaimed(userId: <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/string" target="_blank">string</a>)</code>
                </td>
            </tr>


            <tr>
                <td class="col-md-4">
                    <div class="io-line">Defined in <a href="" data-line="396"
                            class="link-to-prism">src/modules/users/users.service.ts:396</a></div>
                </td>
            </tr>


            <tr>
                <td class="col-md-4">

                    <div class="io-description">
                        <b>Parameters :</b>
                        
                        <table class="params">
                            <thead>
                                <tr>
                                    <td>Name</td>
                                    <td>Type</td>
                                    <td>Optional</td>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td>userId</td>
                                    <td>
                                                <code><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/string" target="_blank" >string</a></code>
                                    </td>

                                    <td>
                                        No
                                    </td>


                                </tr>
                            </tbody>
                        </table>
                    </div>
                    <div>
                    </div>
                    <div class="io-description">
                        <b>Returns : </b>    <code>Promise&lt;boolean&gt;</code>

                    </div>
                    <div class="io-description">
                        
                    </div>
                </td>
            </tr>
        </tbody>
    </table>
    <table class="table table-sm table-bordered">
        <tbody>
            <tr>
                <td class="col-md-4">
                    <a name="isUserUniqueValidationPassed"></a>
                    <span class="name">
                        <span class="modifier">Async</span>
                        <span ><b>isUserUniqueValidationPassed</b></span>
                        <a href="#isUserUniqueValidationPassed"><span class="icon ion-ios-link"></span></a>
                    </span>
                </td>
            </tr>
            <tr>
                <td class="col-md-4">
                    <span class="modifier-icon icon ion-ios-reset"></span>
                    <code>isUserUniqueValidationPassed(email: <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/string" target="_blank">string</a>, username: <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/string" target="_blank">string</a>)</code>
                </td>
            </tr>


            <tr>
                <td class="col-md-4">
                    <div class="io-line">Defined in <a href="" data-line="751"
                            class="link-to-prism">src/modules/users/users.service.ts:751</a></div>
                </td>
            </tr>


            <tr>
                <td class="col-md-4">

                    <div class="io-description">
                        <b>Parameters :</b>
                        
                        <table class="params">
                            <thead>
                                <tr>
                                    <td>Name</td>
                                    <td>Type</td>
                                    <td>Optional</td>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td>email</td>
                                    <td>
                                                <code><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/string" target="_blank" >string</a></code>
                                    </td>

                                    <td>
                                        No
                                    </td>


                                </tr>
                                <tr>
                                    <td>username</td>
                                    <td>
                                                <code><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/string" target="_blank" >string</a></code>
                                    </td>

                                    <td>
                                        No
                                    </td>


                                </tr>
                            </tbody>
                        </table>
                    </div>
                    <div>
                    </div>
                    <div class="io-description">
                        <b>Returns : </b>    <code>Promise&lt;any&gt;</code>

                    </div>
                    <div class="io-description">
                        
                    </div>
                </td>
            </tr>
        </tbody>
    </table>
    <table class="table table-sm table-bordered">
        <tbody>
            <tr>
                <td class="col-md-4">
                    <a name="resetPassword"></a>
                    <span class="name">
                        <span class="modifier">Async</span>
                        <span ><b>resetPassword</b></span>
                        <a href="#resetPassword"><span class="icon ion-ios-link"></span></a>
                    </span>
                </td>
            </tr>
            <tr>
                <td class="col-md-4">
                    <span class="modifier-icon icon ion-ios-reset"></span>
                    <code>resetPassword(passwordData, user)</code>
                </td>
            </tr>


            <tr>
                <td class="col-md-4">
                    <div class="io-line">Defined in <a href="" data-line="220"
                            class="link-to-prism">src/modules/users/users.service.ts:220</a></div>
                </td>
            </tr>


            <tr>
                <td class="col-md-4">

                    <div class="io-description">
                        <b>Parameters :</b>
                        
                        <table class="params">
                            <thead>
                                <tr>
                                    <td>Name</td>
                                    <td>Optional</td>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td>passwordData</td>

                                    <td>
                                        No
                                    </td>


                                </tr>
                                <tr>
                                    <td>user</td>

                                    <td>
                                        No
                                    </td>


                                </tr>
                            </tbody>
                        </table>
                    </div>
                    <div>
                    </div>
                    <div class="io-description">
                        <b>Returns : </b>    <code>Promise&lt;void&gt;</code>

                    </div>
                    <div class="io-description">
                        
                    </div>
                </td>
            </tr>
        </tbody>
    </table>
    <table class="table table-sm table-bordered">
        <tbody>
            <tr>
                <td class="col-md-4">
                    <a name="updateAppleId"></a>
                    <span class="name">
                        <span class="modifier">Async</span>
                        <span ><b>updateAppleId</b></span>
                        <a href="#updateAppleId"><span class="icon ion-ios-link"></span></a>
                    </span>
                </td>
            </tr>
            <tr>
                <td class="col-md-4">
                    <span class="modifier-icon icon ion-ios-reset"></span>
                    <code>updateAppleId(appleId, id)</code>
                </td>
            </tr>


            <tr>
                <td class="col-md-4">
                    <div class="io-line">Defined in <a href="" data-line="543"
                            class="link-to-prism">src/modules/users/users.service.ts:543</a></div>
                </td>
            </tr>


            <tr>
                <td class="col-md-4">

                    <div class="io-description">
                        <b>Parameters :</b>
                        
                        <table class="params">
                            <thead>
                                <tr>
                                    <td>Name</td>
                                    <td>Optional</td>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td>appleId</td>

                                    <td>
                                        No
                                    </td>


                                </tr>
                                <tr>
                                    <td>id</td>

                                    <td>
                                        No
                                    </td>


                                </tr>
                            </tbody>
                        </table>
                    </div>
                    <div>
                    </div>
                    <div class="io-description">
                        <b>Returns : </b>    <code>Promise&lt;void&gt;</code>

                    </div>
                    <div class="io-description">
                        
                    </div>
                </td>
            </tr>
        </tbody>
    </table>
    <table class="table table-sm table-bordered">
        <tbody>
            <tr>
                <td class="col-md-4">
                    <a name="updateFreeTrial"></a>
                    <span class="name">
                        <span class="modifier">Async</span>
                        <span ><b>updateFreeTrial</b></span>
                        <a href="#updateFreeTrial"><span class="icon ion-ios-link"></span></a>
                    </span>
                </td>
            </tr>
            <tr>
                <td class="col-md-4">
                    <span class="modifier-icon icon ion-ios-reset"></span>
                    <code>updateFreeTrial(userId: <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/string" target="_blank">string</a>, claim_freetrial: <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/boolean" target="_blank">boolean</a>)</code>
                </td>
            </tr>


            <tr>
                <td class="col-md-4">
                    <div class="io-line">Defined in <a href="" data-line="404"
                            class="link-to-prism">src/modules/users/users.service.ts:404</a></div>
                </td>
            </tr>


            <tr>
                <td class="col-md-4">

                    <div class="io-description">
                        <b>Parameters :</b>
                        
                        <table class="params">
                            <thead>
                                <tr>
                                    <td>Name</td>
                                    <td>Type</td>
                                    <td>Optional</td>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td>userId</td>
                                    <td>
                                                <code><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/string" target="_blank" >string</a></code>
                                    </td>

                                    <td>
                                        No
                                    </td>


                                </tr>
                                <tr>
                                    <td>claim_freetrial</td>
                                    <td>
                                                <code><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/boolean" target="_blank" >boolean</a></code>
                                    </td>

                                    <td>
                                        No
                                    </td>


                                </tr>
                            </tbody>
                        </table>
                    </div>
                    <div>
                    </div>
                    <div class="io-description">
                        <b>Returns : </b>    <code>Promise&lt;void&gt;</code>

                    </div>
                    <div class="io-description">
                        
                    </div>
                </td>
            </tr>
        </tbody>
    </table>
    <table class="table table-sm table-bordered">
        <tbody>
            <tr>
                <td class="col-md-4">
                    <a name="updateMemberType"></a>
                    <span class="name">
                        <span class="modifier">Async</span>
                        <span ><b>updateMemberType</b></span>
                        <a href="#updateMemberType"><span class="icon ion-ios-link"></span></a>
                    </span>
                </td>
            </tr>
            <tr>
                <td class="col-md-4">
                    <span class="modifier-icon icon ion-ios-reset"></span>
                    <code>updateMemberType(userId: <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/string" target="_blank">string</a>, type: <a href="../undefineds/member_type.html" target="_self">member_type</a>)</code>
                </td>
            </tr>


            <tr>
                <td class="col-md-4">
                    <div class="io-line">Defined in <a href="" data-line="373"
                            class="link-to-prism">src/modules/users/users.service.ts:373</a></div>
                </td>
            </tr>


            <tr>
                <td class="col-md-4">

                    <div class="io-description">
                        <b>Parameters :</b>
                        
                        <table class="params">
                            <thead>
                                <tr>
                                    <td>Name</td>
                                    <td>Type</td>
                                    <td>Optional</td>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td>userId</td>
                                    <td>
                                                <code><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/string" target="_blank" >string</a></code>
                                    </td>

                                    <td>
                                        No
                                    </td>


                                </tr>
                                <tr>
                                    <td>type</td>
                                    <td>
                                                <code><a href="../miscellaneous/enumerations.html#member_type" target="_self" >member_type</a></code>
                                    </td>

                                    <td>
                                        No
                                    </td>


                                </tr>
                            </tbody>
                        </table>
                    </div>
                    <div>
                    </div>
                    <div class="io-description">
                        <b>Returns : </b>    <code>Promise&lt;void&gt;</code>

                    </div>
                    <div class="io-description">
                        
                    </div>
                </td>
            </tr>
        </tbody>
    </table>
    <table class="table table-sm table-bordered">
        <tbody>
            <tr>
                <td class="col-md-4">
                    <a name="updatePassWord"></a>
                    <span class="name">
                        <span class="modifier">Async</span>
                        <span ><b>updatePassWord</b></span>
                        <a href="#updatePassWord"><span class="icon ion-ios-link"></span></a>
                    </span>
                </td>
            </tr>
            <tr>
                <td class="col-md-4">
                    <span class="modifier-icon icon ion-ios-reset"></span>
                    <code>updatePassWord(passwordData, user)</code>
                </td>
            </tr>


            <tr>
                <td class="col-md-4">
                    <div class="io-line">Defined in <a href="" data-line="176"
                            class="link-to-prism">src/modules/users/users.service.ts:176</a></div>
                </td>
            </tr>


            <tr>
                <td class="col-md-4">

                    <div class="io-description">
                        <b>Parameters :</b>
                        
                        <table class="params">
                            <thead>
                                <tr>
                                    <td>Name</td>
                                    <td>Optional</td>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td>passwordData</td>

                                    <td>
                                        No
                                    </td>


                                </tr>
                                <tr>
                                    <td>user</td>

                                    <td>
                                        No
                                    </td>


                                </tr>
                            </tbody>
                        </table>
                    </div>
                    <div>
                    </div>
                    <div class="io-description">
                        <b>Returns : </b>    <code>Promise&lt;void&gt;</code>

                    </div>
                    <div class="io-description">
                        
                    </div>
                </td>
            </tr>
        </tbody>
    </table>
    <table class="table table-sm table-bordered">
        <tbody>
            <tr>
                <td class="col-md-4">
                    <a name="updateReferralCodeStatus"></a>
                    <span class="name">
                        <span class="modifier">Async</span>
                        <span ><b>updateReferralCodeStatus</b></span>
                        <a href="#updateReferralCodeStatus"><span class="icon ion-ios-link"></span></a>
                    </span>
                </td>
            </tr>
            <tr>
                <td class="col-md-4">
                    <span class="modifier-icon icon ion-ios-reset"></span>
                    <code>updateReferralCodeStatus(userId: <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/string" target="_blank">string</a>, claim_referralcode: <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/boolean" target="_blank">boolean</a>)</code>
                </td>
            </tr>


            <tr>
                <td class="col-md-4">
                    <div class="io-line">Defined in <a href="" data-line="419"
                            class="link-to-prism">src/modules/users/users.service.ts:419</a></div>
                </td>
            </tr>


            <tr>
                <td class="col-md-4">

                    <div class="io-description">
                        <b>Parameters :</b>
                        
                        <table class="params">
                            <thead>
                                <tr>
                                    <td>Name</td>
                                    <td>Type</td>
                                    <td>Optional</td>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td>userId</td>
                                    <td>
                                                <code><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/string" target="_blank" >string</a></code>
                                    </td>

                                    <td>
                                        No
                                    </td>


                                </tr>
                                <tr>
                                    <td>claim_referralcode</td>
                                    <td>
                                                <code><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/boolean" target="_blank" >boolean</a></code>
                                    </td>

                                    <td>
                                        No
                                    </td>


                                </tr>
                            </tbody>
                        </table>
                    </div>
                    <div>
                    </div>
                    <div class="io-description">
                        <b>Returns : </b>    <code>Promise&lt;void&gt;</code>

                    </div>
                    <div class="io-description">
                        
                    </div>
                </td>
            </tr>
        </tbody>
    </table>
    <table class="table table-sm table-bordered">
        <tbody>
            <tr>
                <td class="col-md-4">
                    <a name="updateStripeId"></a>
                    <span class="name">
                        <span class="modifier">Async</span>
                        <span ><b>updateStripeId</b></span>
                        <a href="#updateStripeId"><span class="icon ion-ios-link"></span></a>
                    </span>
                </td>
            </tr>
            <tr>
                <td class="col-md-4">
                    <span class="modifier-icon icon ion-ios-reset"></span>
                    <code>updateStripeId(data, stripeId)</code>
                </td>
            </tr>


            <tr>
                <td class="col-md-4">
                    <div class="io-line">Defined in <a href="" data-line="359"
                            class="link-to-prism">src/modules/users/users.service.ts:359</a></div>
                </td>
            </tr>


            <tr>
                <td class="col-md-4">

                    <div class="io-description">
                        <b>Parameters :</b>
                        
                        <table class="params">
                            <thead>
                                <tr>
                                    <td>Name</td>
                                    <td>Optional</td>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td>data</td>

                                    <td>
                                        No
                                    </td>


                                </tr>
                                <tr>
                                    <td>stripeId</td>

                                    <td>
                                        No
                                    </td>


                                </tr>
                            </tbody>
                        </table>
                    </div>
                    <div>
                    </div>
                    <div class="io-description">
                        <b>Returns : </b>    <code>Promise&lt;void&gt;</code>

                    </div>
                    <div class="io-description">
                        
                    </div>
                </td>
            </tr>
        </tbody>
    </table>
    <table class="table table-sm table-bordered">
        <tbody>
            <tr>
                <td class="col-md-4">
                    <a name="updateUser"></a>
                    <span class="name">
                        <span class="modifier">Async</span>
                        <span ><b>updateUser</b></span>
                        <a href="#updateUser"><span class="icon ion-ios-link"></span></a>
                    </span>
                </td>
            </tr>
            <tr>
                <td class="col-md-4">
                    <span class="modifier-icon icon ion-ios-reset"></span>
                    <code>updateUser(userData: <a href="../interfaces/User.html" target="_self">updateUser</a>, user)</code>
                </td>
            </tr>


            <tr>
                <td class="col-md-4">
                    <div class="io-line">Defined in <a href="" data-line="150"
                            class="link-to-prism">src/modules/users/users.service.ts:150</a></div>
                </td>
            </tr>


            <tr>
                <td class="col-md-4">

                    <div class="io-description">
                        <b>Parameters :</b>
                        
                        <table class="params">
                            <thead>
                                <tr>
                                    <td>Name</td>
                                    <td>Type</td>
                                    <td>Optional</td>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td>userData</td>
                                    <td>
                                                <code><a href="../interfaces/User.html" target="_self" >updateUser</a></code>
                                    </td>

                                    <td>
                                        No
                                    </td>


                                </tr>
                                <tr>
                                    <td>user</td>
                                    <td>
                                    </td>

                                    <td>
                                        No
                                    </td>


                                </tr>
                            </tbody>
                        </table>
                    </div>
                    <div>
                    </div>
                    <div class="io-description">
                        <b>Returns : </b>    <code>Promise&lt;void&gt;</code>

                    </div>
                    <div class="io-description">
                        
                    </div>
                </td>
            </tr>
        </tbody>
    </table>
    <table class="table table-sm table-bordered">
        <tbody>
            <tr>
                <td class="col-md-4">
                    <a name="verifyToken"></a>
                    <span class="name">
                        <span class="modifier">Async</span>
                        <span ><b>verifyToken</b></span>
                        <a href="#verifyToken"><span class="icon ion-ios-link"></span></a>
                    </span>
                </td>
            </tr>
            <tr>
                <td class="col-md-4">
                    <span class="modifier-icon icon ion-ios-reset"></span>
                    <code>verifyToken(token)</code>
                </td>
            </tr>


            <tr>
                <td class="col-md-4">
                    <div class="io-line">Defined in <a href="" data-line="311"
                            class="link-to-prism">src/modules/users/users.service.ts:311</a></div>
                </td>
            </tr>


            <tr>
                <td class="col-md-4">

                    <div class="io-description">
                        <b>Parameters :</b>
                        
                        <table class="params">
                            <thead>
                                <tr>
                                    <td>Name</td>
                                    <td>Optional</td>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td>token</td>

                                    <td>
                                        No
                                    </td>


                                </tr>
                            </tbody>
                        </table>
                    </div>
                    <div>
                    </div>
                    <div class="io-description">
                        <b>Returns : </b>    <code>Promise&lt;object&gt;</code>

                    </div>
                    <div class="io-description">
                        
                    </div>
                </td>
            </tr>
        </tbody>
    </table>
</section>

    </div>


    <div class="tab-pane fade  tab-source-code" id="c-source">
        <pre class="line-numbers compodoc-sourcecode"><code class="language-typescript">import { Injectable, HttpException, HttpStatus } from &#x27;@nestjs/common&#x27;;
import * as bcrypt from &#x27;bcryptjs&#x27;;
import { I18nService } from &#x27;nestjs-i18n&#x27;;

import { userLang } from &#x27;../../helpers/app.helpers&#x27;;
import { FeedbackEntity, UserEntity, UserTokenEntity } from &#x27;./entities&#x27;;
import { AuthEntity } from &#x27;../auth/entities&#x27;;
import { User } from &#x27;./users.interface&#x27;;
import { Response } from &#x27;../../helpers/response&#x27;;
import { InjectRepository} from &#x27;@nestjs/typeorm&#x27;;
import { Repository, getConnection} from &#x27;typeorm&#x27;;
import { EmailSender } from &#x27;../../helpers/email.sender&#x27;;
import { token_type, token_status, unit_of_time, forget_pass, member_type, subscription_status, registration_platform, payment_method, payment_status } from &#x27;../../helpers/util&#x27;;
import * as moment from &#x27;moment-timezone&#x27;;
import * as ejs from &#x27;ejs&#x27;;
import { updateUser } from &#x27;./dto&#x27;;
import { Logger } from &#x27;../../helpers/logger&#x27;;
import { UserSubscriptionEntity } from &#x27;../subscription/entities/user-subscription.entity&#x27;;
import { SubscriptionPlanEntity } from &#x27;../subscription/entities/subscription-plan.entity&#x27;;
import { UserInterestEntity } from &#x27;../categories/entities&#x27;;
import { ExportFile } from &#x27;../../helpers/export-file&#x27;;
import { UserPaymentEntity } from &#x27;../subscription/entities/user-payment.entity&#x27;;
import { randomBytes } from &#x27;crypto&#x27;;

@Injectable()
export class UsersService {

    constructor(

        private readonly response: Response,
        private readonly emailSender: EmailSender,
        private readonly i18n: I18nService,
        private readonly exportFile: ExportFile,

        @InjectRepository(UserEntity)
        private userRepository: Repository&lt;UserEntity&gt;,

        @InjectRepository(AuthEntity)
        private authEntityRepository: Repository&lt;AuthEntity&gt;,

        @InjectRepository(UserInterestEntity)
        private userInterestRepository: Repository&lt;UserInterestEntity&gt;,

        @InjectRepository(UserPaymentEntity)
        private userPaymentRepository: Repository&lt;UserPaymentEntity&gt;,
      ) {};

    getUser(id, email, additionalSelect &#x3D; null, appleId &#x3D; null) {
      
        const select &#x3D; [
            &#x27;user._id as id&#x27;, 
            &#x27;user.firstname as first_name&#x27;, 
            &#x27;user.email as email&#x27;,
            &#x27;user.lastname as last_name&#x27;, 
            &#x27;user.member_type as member_type&#x27;,
            &#x27;user.language as language&#x27;, 
            &#x27;user.user_label as label&#x27;, 
            &#x27;user.avatar as avatar&#x27;, 
            &#x27;user.language as language&#x27;, 
            &#x27;user.last_login_at as last_login_at&#x27;, 
            &#x27;user._created_at as created_at&#x27;,
            &#x27;user.deleted_at as deleted_at&#x27;,
            &#x60;&quot;user&quot;.&quot;apple_id&quot; as apple_id&#x60;, 
            &#x60;&quot;user&quot;.&quot;referral_code&quot; as referral_code&#x60;,
            &#x60;&quot;user&quot;.claim_freetrial as claim_freetrial&#x60;,
            &#x60;&quot;user&quot;.claim_referralcode as claim_referralcode&#x60;,
        ]
        if ( additionalSelect ) Array.prototype.push.apply(select, additionalSelect)

        let user &#x3D; this.userRepository
        .createQueryBuilder(&quot;user&quot;)
        .select(select)

        if(email) user &#x3D; user.where(&#x27;user.email &#x3D; :email&#x27;, { email })
        if(appleId &amp;&amp; email){
            user &#x3D;  user.where(&#x60;&quot;user&quot;.&quot;apple_id&quot; &#x3D; :appleId&#x60;, { appleId })
                .orWhere(&#x27;user.email &#x3D; :email&#x27;, { email })
            }
        if(id) user &#x3D; user.where(&#x27;user._id &#x3D; :id&#x27;, { id })

        return user;
    }

    async findOne(id, email): Promise&lt;User&gt; {
        return await this.getUser(id, email)
        .getRawOne()
    }

    async addUser(user, socialLogin &#x3D; null, registration_platform &#x3D; null): Promise&lt;void&gt; {
            
        const queryRunner &#x3D; getConnection().createQueryRunner();
        await queryRunner.connect();
        await queryRunner.startTransaction();
        try {
   
            const addUser: UserEntity &#x3D; new UserEntity( 
                user.username ? user.username : user.email,
                user.email, 
                moment().local().format(),
                user.first_name, 
                user.last_name, 
                null, 
                user.user_type, 
                null, 
                null, 
                user.avatar ? user.avatar : null, 
                &#x27;&#x27;,
                &#x27;&#x27;, 
                null, 
                moment().tz(&#x27;Hongkong&#x27;).format(), moment().tz(&#x27;Hongkong&#x27;).format(), 
                user.apple_id ? user.apple_id : null, 
                socialLogin,
                registration_platform,
                await this.generateReferralCode(socialLogin &#x3D;&#x3D; &#x27;apple&#x27; ? false : true) 
            );
            
            const userData &#x3D;  await queryRunner.manager.save(addUser);

            const authUser: AuthEntity &#x3D; new AuthEntity()
            authUser.id &#x3D; userData._id
            authUser.token_valid_since &#x3D; moment().local().format()
            authUser.disabled &#x3D; false
            authUser.password &#x3D; user.password

            const ownerId &#x3D; {
                _owner_id : userData._id,
                _created_by: userData._id,
            }

            await queryRunner.manager.save(authUser);

            await queryRunner.manager.update(UserEntity, { _id: userData._id }, ownerId );  

            await queryRunner.commitTransaction();
        
        }catch(err) {
            await queryRunner.rollbackTransaction();
            Logger.error(&#x60;failed to create user : ${user.email}&#x60;, {email: user.email, error : err, socialLogin} );
            throw new HttpException(await this.response.response(  
                await this.i18n.translate(&#x27;message.GENERAL.ERROR.SERVER_ERROR&#x27;, { lang: await userLang(user) }), 
                null, null), HttpStatus.INTERNAL_SERVER_ERROR
            )
        }
        finally {
            await queryRunner.release();
        }
    };

    // eslint-disable-next-line @typescript-eslint/ban-types
    async updateUser(userData : updateUser, user) : Promise&lt;void&gt;{

        const oldData &#x3D; await this.getUser(user.sub, null, [&#x27;user.birthday as birthday&#x27;]).getRawOne();

        const requestData &#x3D; {
            firstname : !userData[&#x27;firstname&#x27;] || userData[&#x27;firstname&#x27;] &#x3D;&#x3D; &quot;&quot; ? oldData[&#x27;first_name&#x27;] : userData[&#x27;firstname&#x27;] ,
            lastname : !userData[&#x27;lastname&#x27;] || userData[&#x27;lastname&#x27;] &#x3D;&#x3D; &quot;&quot; ? oldData[&#x27;last_name&#x27;] : userData[&#x27;lastname&#x27;] ,
            avatar : !userData[&#x27;avatar&#x27;] || userData[&#x27;avatar&#x27;] &#x3D;&#x3D; &quot;&quot; ? oldData[&#x27;avatar&#x27;] : userData[&#x27;avatar&#x27;] ,
            language : !userData[&#x27;language&#x27;] || userData[&#x27;language&#x27;] &#x3D;&#x3D; &quot;&quot; ? oldData[&#x27;language&#x27;] : userData[&#x27;language&#x27;] ,
            birthday : !userData[&#x27;birthday&#x27;] || userData[&#x27;birthday&#x27;].toString() &#x3D;&#x3D; &quot;&quot; ? oldData[&#x27;birthday&#x27;] : userData[&#x27;birthday&#x27;],
            last_login_at : !userData[&#x27;last_login_at&#x27;] || userData[&#x27;last_login_at&#x27;].toString() &#x3D;&#x3D; &quot;&quot; ? oldData[&#x27;last_login_at&#x27;] : userData[&#x27;last_login_at&#x27;],
            _updated_at : moment().format(&#x27;YYYY-MM-DD HH:mm:ss&#x27;),
        }

        try {
            await this.userRepository.update({ _id: user.sub }, requestData)
        } catch(error) {
            Logger.error( &#x60;invalid update usser, ${error}&#x60;, userData);
            throw new HttpException(await this.response.response(  
                await this.i18n.translate(&#x27;message.GENERAL.ERROR.SERVER_ERROR&#x27;, { lang: await userLang(user) }), 
                null, null), HttpStatus.INTERNAL_SERVER_ERROR
            )
        }

    }

    async updatePassWord(passwordData, user): Promise&lt;void&gt; {

        const authData &#x3D; { password:  await bcrypt.hashSync(passwordData.new_password, Number(10)) }
        try {
            const userId &#x3D; user.sub ?? user.id;
            await this.authEntityRepository.update( { id: userId }, authData )
        } catch(error){
            Logger.error( &#x60;invalid reset password, ${user.userId, error},&#x60;);
            const message &#x3D;  await this.i18n.translate(&#x27;message.GENERAL.ERROR.SERVER_ERROR&#x27;, { lang: await userLang(user) })
            const err &#x3D; [{ &quot;reset-password&quot; : message }];
            throw new HttpException(await this.response.response(  
                message,
                null, err), HttpStatus.INTERNAL_SERVER_ERROR
            )
        }
    }

    async createNewUser (userData): Promise&lt;void&gt; {
        if(userData.registration_platform &amp;&amp; !Object.values(registration_platform).includes(userData.registration_platform)){
            Logger.error(&#x60;Invalid platform selected, platform must be ios, android, or website&#x60;);
            const err &#x3D; [{ &quot;register&quot; : &#x27;Invalid platform selected, platform must be ios, android, or website&#x27; }];
            throw new HttpException(await this.response.response(&#x27;Invalid platform selected, platform must be ios, android, or website&#x27;, null, err), HttpStatus.BAD_REQUEST); 
        }

        const user &#x3D; await this.getUser(null, userData.email)
        .getRawOne();

        if (user &amp;&amp; user.apple_id) {
            Logger.error(&#x60;user already exist registered by SSO apple: ${userData.email}&#x60;);
            throw new HttpException(await this.response.response(  
                await this.i18n.translate(&#x27;message.USER.USER_REGISTERED_ON_SSO&#x27;, { lang: await userLang(user) }), 
                null, null), HttpStatus.INTERNAL_SERVER_ERROR
            ) 
        }
        if(user) {
            Logger.error(&#x60;user already exist: ${userData.email}&#x60;);
            throw new HttpException(await this.response.response(  
                await this.i18n.translate(&#x27;message.USER.USER_REGISTERED&#x27;, { lang: await userLang(user) }), 
                null, null), HttpStatus.INTERNAL_SERVER_ERROR
            ) 
        }
        await this.addUser(userData, null, userData.registration_platform)
    }

    async resetPassword(passwordData, user): Promise&lt;void&gt; {
       
        const users &#x3D; await this.getUser(user.sub, null)
        .select([&#x27;auth.password&#x27;, &#x27;user.email&#x27;, &#x27;user._id as id&#x27;])
        .innerJoin( AuthEntity, &#x27;auth&#x27;, &#x27;auth.id &#x3D; user._id&#x27;)
        .getRawOne();

        if(!users) {
            Logger.error(&#x60;user is not exist: ${user.sub}&#x60;);
            const message &#x3D;  await this.i18n.translate(&#x27;message.USER.USER_NOT_FOUND&#x27;, { lang: await userLang(user) })
            const err &#x3D; [{ &quot;reset-password&quot; : message }];
            throw new HttpException(await this.response.response(  
                message,
                null, err), HttpStatus.NOT_FOUND
            )
        }

        const pass &#x3D; await bcrypt.compareSync(passwordData.old_password, users.auth_password)

        if (!pass) {
            Logger.error( &#x60;password inserted is wrong: ${user.sub}&#x60;);
            const message &#x3D;  await this.i18n.translate(&#x27;message.USER.INCORRECT_PASSWORD&#x27;, { lang: await userLang(user) })
            const err &#x3D; [{ &quot;reset-password&quot; : message }];
            throw new HttpException(await this.response.response(  
                message,
                null, err), HttpStatus.BAD_REQUEST
            )
        }

        await this.updatePassWord(passwordData, user)

    }

    async forgetPassword(userData) {

        const after30min &#x3D; moment().add(unit_of_time.half_hour, &#x27;minutes&#x27;).format()
        const user &#x3D; await this.getUser(null, userData.email).getRawOne()
        if (user &amp;&amp; user.apple_id) {
            Logger.error(&#x60;user registered by SSO apple, cant reset password, email: ${userData.email}&#x60;);
            throw new HttpException(await this.response.response(&#x27;Failed to Process Forget Password, User Registered Using SSO&#x27;, null, null), HttpStatus.BAD_REQUEST); 
        }
        
        if(!user) {
            Logger.error(&#x60;user not found: ${userData.email}&#x60;);
            const err &#x3D; [{ &quot;forget-password&quot; : &#x27;User Not Registered&#x27; }];
            throw new HttpException(await this.response.response(&#x27;沒有此電郵的帳戶&#x27;, null, null), HttpStatus.NOT_FOUND); 
        }
        // let token &#x3D; await bcrypt.hashSync(userData.email, Number(10))
        const token &#x3D; randomBytes(40).toString(&#x27;hex&#x27;);

        const date &#x3D; new Date();

        const dataUser &#x3D; {
            redirect_uri: &#x60;${process.env.RESET_PASSWORD_URI}/?code&#x3D;${token}&#x60;,
        }
        
        const template &#x3D; await ejs.renderFile(__dirname + &quot;/templates/forget-password.ejs&quot;, { dataUser })
        const emailData &#x3D; {
            receiver : userData.email,
            subject: forget_pass.email_subject,
            text: null,
            template
        }
        const userToken &#x3D; new UserTokenEntity()
        userToken.user_id &#x3D; user.id
        userToken.expired_at &#x3D; moment(after30min).utc().toISOString()
        userToken.token &#x3D; token
        userToken.type &#x3D; token_type.RESET_PASSWORD

        try {
            await userToken.save();
            await this.emailSender.send(emailData);
        } catch (err) {
            Logger.error(&#x60;failed to processing forget password , error:${err}&#x60;,userData);
            const message &#x3D;  await this.i18n.translate(&#x27;message.GENERAL.ERROR.SERVER_ERROR&#x27;, { lang: await userLang(user) })
            const error &#x3D; [{ &quot;forget-password&quot; : message }];
            throw new HttpException(await this.response.response(  
                message,
                null, error), HttpStatus.INTERNAL_SERVER_ERROR
            )
        }
    }
    async addLastLoginAt(id) : Promise&lt;void&gt;{
        const user &#x3D; { 
            last_login_at : moment().tz(&#x27;Hongkong&#x27;).format()
        }
        await this.userRepository.update(
            { _id: id } , user
          );
    }

    async verifyToken(token): Promise&lt;object&gt; {

        const userToken &#x3D; await UserTokenEntity
            .createQueryBuilder(&quot;token&quot;)
            .select([&#x27;token.id as token_id&#x27;, &#x27;token as token&#x27;, &#x27;expired_at as expired_at&#x27;, &#x27;user._id as sub&#x27;])
            .innerJoin(UserEntity, &#x27;user&#x27;, &#x27;token.user_id &#x3D; user._id&#x27;)
            .where(&#x27;token.token &#x3D; :token&#x27;, { token })
            .andWhere(&#x27;token.expired_at &gt; :now&#x27;, { now: moment().local().format() })
            .andWhere(&#x27;token.type &#x3D; :type&#x27;, { type: token_type.RESET_PASSWORD })
            .andWhere(&#x27;token.status &#x3D; :status&#x27;, {status: token_status.VALID })
            .getRawOne()

            if (!userToken) {
                Logger.error(&#x60;Token is Not Found or Expired&#x60;, { token });
                const message &#x3D;  await this.i18n.translate(&#x27;message.GENERAL.ERROR.SERVER_ERROR&#x27;, { lang: await userLang(null) })
                const error &#x3D; [{ &quot;verify-token&quot; : message }];
                throw new HttpException(await this.response.response(  
                    message,
                    null, error), HttpStatus.INTERNAL_SERVER_ERROR
                )
            } else {
                return userToken
            }
        }

    async confirmPassword(userData): Promise&lt;void&gt;{
        const token &#x3D; encodeURIComponent(userData.token)
        const userToken &#x3D; await this.verifyToken(token)

        try{
            await this.updatePassWord(userData, userToken)

            await UserTokenEntity.update(
                { id: (userToken as any).token_id } , 
                { status: token_status.INVALID }
            );

        }catch (err) {
            Logger.error(&#x60;failed to processing confirm password ,error:${err}&#x60;);
            const message &#x3D;  await this.i18n.translate(&#x27;message.GENERAL.ERROR.SERVER_ERROR&#x27;, { lang: await userLang(null) })
            const error &#x3D; [{ &quot;confirm-password&quot; : message }];
            throw new HttpException(await this.response.response(  
                message,
                null, error), HttpStatus.INTERNAL_SERVER_ERROR
            )
        }
    }   

    async updateStripeId(data, stripeId): Promise&lt;void&gt; {
        try {
            await this.authEntityRepository.update({id: data.id}, { stripe_id: stripeId })
        } catch(error){
            Logger.info(&#x27;invalid update strip id&#x27;, {data, stripeId});
            const message &#x3D;  await this.i18n.translate(&#x27;message.GENERAL.ERROR.SERVER_ERROR&#x27;, { lang: await userLang(null) })
            const err &#x3D; [{ &quot;stripe-id&quot; : message }];
            throw new HttpException(await this.response.response(  
                message,
                null, err), HttpStatus.INTERNAL_SERVER_ERROR
            )
        }
    }

    async updateMemberType(userId : string, type : member_type): Promise&lt;void&gt; {
        try {
            await this.userRepository.update({ _id: userId }, { member_type : type, _updated_at : moment().local().format()});
            Logger.info(&#x60;Successfully update user member_type with id ${userId}&#x60;);
        } catch(error){
            Logger.error( &#x60;Failed to update member type ${userId}, ${error}&#x60;, type);
            const message &#x3D;  await this.i18n.translate(&#x27;message.GENERAL.ERROR.SERVER_ERROR&#x27;, { lang: await userLang(null) })
            const err &#x3D; [{ &quot;update-member-type&quot; : message }];
            throw new HttpException(await this.response.response(  
                message,
                null, err), HttpStatus.INTERNAL_SERVER_ERROR
            )
        }
    }

    async isFreeTrialClaimed(userId : string): Promise&lt;boolean&gt; {
        const additionalSelect &#x3D; [ &#x27;user.claim_freetrial as claim_freetrial&#x27;]
        const user &#x3D; await this.getUser(userId, null, additionalSelect)
        .getRawOne();

        return user[&#x27;claim_freetrial&#x27;];
    }

    async isReferralCodeClaimed(userId : string): Promise&lt;boolean&gt; {
        const additionalSelect &#x3D; [ &#x27;user.claim_referralcode as claim_referralcode&#x27;]
        const user &#x3D; await this.getUser(userId, null, additionalSelect)
        .getRawOne();

        return user[&#x27;claim_referralcode&#x27;];
    }

    async updateFreeTrial(userId : string, claim_freetrial : boolean): Promise&lt;void&gt; {
        try {
            await this.userRepository.update({ _id: userId }, { claim_freetrial : claim_freetrial, _updated_at : moment().local().format()});
            Logger.info(&#x60;Successfully update user claim_freetrial with id ${userId}&#x60;);
        } catch(error){
            Logger.error( &#x60;Failed to update user claim_freetrial with id ${userId}, ${error}&#x60;);
            const message &#x3D;  await this.i18n.translate(&#x27;message.GENERAL.ERROR.SERVER_ERROR&#x27;, { lang: await userLang(null) })
            const err &#x3D; [{ &quot;update-member-type&quot; : message }];
            throw new HttpException(await this.response.response(  
                message,
                null, err), HttpStatus.INTERNAL_SERVER_ERROR
            )
        }
    }

    async updateReferralCodeStatus(userId : string, claim_referralcode : boolean): Promise&lt;void&gt; {
        try {
            await this.userRepository.update({ _id: userId }, { claim_referralcode : claim_referralcode, _updated_at : moment().local().format()});
            Logger.info(&#x60;Successfully update user claim_referralcode with id ${userId}&#x60;);
        } catch(error){
            Logger.error( &#x60;Failed to update user claim_referralcode with id ${userId}, ${error}&#x60;);
            const message &#x3D;  await this.i18n.translate(&#x27;message.GENERAL.ERROR.SERVER_ERROR&#x27;, { lang: await userLang(null) })
            const err &#x3D; [{ &quot;update-member-type&quot; : message }];
            throw new HttpException(await this.response.response(  
                message,
                null, err), HttpStatus.INTERNAL_SERVER_ERROR
            )
        }
    }

    // eslint-disable-next-line @typescript-eslint/ban-types
    async getUserByReferralCode(referral_code : string) : Promise&lt;Object&gt;{
        const user &#x3D; await this.userRepository
        .createQueryBuilder(&quot;user&quot;)
        .leftJoin(UserSubscriptionEntity,&#x27;user_subscription&#x27;,&#x27;user_subscription.user_label &#x3D; user.user_label&#x27;)
        .select([
            &#x27;user._id as id&#x27;, 
            &#x27;user.firstname as first_name&#x27;, 
            &#x27;user.email as email&#x27;,
            &#x27;user.lastname as last_name&#x27;, 
            &#x27;user.member_type as member_type&#x27;,
            &#x27;user.user_label as user_label&#x27;,
            &#x27;user.referral_code as referral_code&#x27;,
            &#x27;user.claim_referralcode as claim_referralcode&#x27;,
            &#x27;user.claim_freetrial as claim_freetrial&#x27;,
            &#x60;array_agg(DISTINCT jsonb_build_object(
                    &#x27;user_label&#x27;, user_subscription.user_label,
                    &#x27;order_id&#x27;, user_subscription.order_id,
                    &#x27;startdate&#x27;, user_subscription.startdate,
                    &#x27;enddate&#x27;, user_subscription.enddate,
                    &#x27;extra_enddate&#x27;, user_subscription.extra_enddate,
                    &#x27;is_referral_bonus_claimed&#x27;, user_subscription.is_referral_bonus_claimed,
                    &#x27;status&#x27;, user_subscription.status,
                    &#x27;created_at&#x27;, user_subscription._created_at
                )
            ) AS user_subscriptions&#x60;,
        ])
        .where(&#x27;user.referral_code &#x3D; :referral_code&#x27;, { referral_code })
        .groupBy(
        &#x60;user._id,
         user.firstname,
         user.email,
         user.lastname,
         user.member_type,
         user.user_label,
         user.referral_code,
         user.claim_referralcode,
         user.claim_freetrial
        &#x60;).getRawOne();

        const user_subscriptions &#x3D; []
        if(user) {
            await user.user_subscriptions.map((user_subscription)&#x3D;&gt;{
                if( user_subscription.order_id !&#x3D;&#x3D; null &amp;&amp; user_subscription.status &#x3D;&#x3D; subscription_status.ACTIVE ) {
                    user_subscriptions.push(user_subscription)
                }
            });
            user.user_subscriptions &#x3D; user_subscriptions.sort(function (a, b) {
                const paramsA &#x3D; new Date(a.enddate).getTime() &gt; new Date(a.extra_enddate).getTime() ? new Date(a.enddate).getTime() : new Date(a.extra_enddate).getTime();
                const paramsB &#x3D; new Date(b.enddate).getTime() &gt; new Date(b.extra_enddate).getTime() ? new Date(b.enddate).getTime() : new Date(b.extra_enddate).getTime();
                return paramsB - paramsA;
              });;
        }

        return user;
    }

    // eslint-disable-next-line @typescript-eslint/ban-types
    async getUserWithSubscription(userId, additionalSelect &#x3D; null): Promise&lt;Object&gt;{
        const select &#x3D; [  
            &#x60;json_agg(DISTINCT jsonb_build_object(
                &#x27;user_label&#x27;, userSubscription.user_label,
                &#x27;order_id&#x27;, userSubscription.order_id,
                &#x27;subscription_ref_code&#x27;, userSubscription.subscription_ref_code,
                &#x27;subscription_type&#x27;, subscriptionplan.subscription_type,
                &#x27;startdate&#x27;, userSubscription.startdate,
                &#x27;enddate&#x27;, userSubscription.enddate,
                &#x27;extra_enddate&#x27;, userSubscription.extra_enddate,
                &#x27;status&#x27;, userSubscription.status,
                &#x27;created_at&#x27;, userSubscription._created_at
                )
            ) AS user_subscriptions&#x60; ]  

            if ( additionalSelect ) Array.prototype.push.apply(select, additionalSelect)
            const data &#x3D; await this.getUser(userId, null, select)
               .leftJoin(UserSubscriptionEntity, &#x27;userSubscription&#x27;, &#x27;userSubscription.user_label &#x3D; user.user_label AND userSubscription.status &#x3D; :status&#x27;, {status:subscription_status.ACTIVE})
               .leftJoin(SubscriptionPlanEntity, &#x27;subscriptionplan&#x27;, &#x27;subscriptionplan.ref_code &#x3D; userSubscription.subscription_ref_code&#x27;)
               .groupBy(
               &#x60;user._id, 
                user.firstname, 
                user.email,
                user.lastname, 
                user.member_type,
                user.language, 
                user.user_label, 
                user.avatar, 
                user.language, 
                user.last_login_at, 
                user._created_at,
                user.apple_id, 
                user.referral_code,
                user.claim_freetrial,
                user.claim_referralcode,
                user.birthday,
                user.deleted_at 
                &#x60;)
               .getRawOne();

        const subscription &#x3D; data.user_subscriptions.sort(function (a, b) {
               const paramsA &#x3D; new Date(a.enddate).getTime() &gt; new Date(a.extra_enddate).getTime() ? new Date(a.enddate).getTime() : new Date(a.extra_enddate).getTime();
               const paramsB &#x3D; new Date(b.enddate).getTime() &gt; new Date(b.extra_enddate).getTime() ? new Date(b.enddate).getTime() : new Date(b.extra_enddate).getTime();
               return paramsB - paramsA;
        });   
    
        data.user_subscriptions &#x3D; subscription
        return data;

    }

    async updateAppleId(appleId, id): Promise&lt;void&gt; {
        try {
            await getConnection()
            .createQueryBuilder()
            .update(UserEntity)
            .set({ apple_id: appleId})
            .where(&quot;_id &#x3D; :id&quot;, { id })
            .execute();
        } catch(error){
            Logger.error( &#x60;invalid update apple_id, ${error},&#x60;, {id});
            const message &#x3D;  await this.i18n.translate(&#x27;message.GENERAL.ERROR.SERVER_ERROR&#x27;, { lang: await userLang(null) })
            const err &#x3D; [{ &quot;apple_id&quot; : message }];
            throw new HttpException(await this.response.response(  
                message,
                null, err), HttpStatus.INTERNAL_SERVER_ERROR
            )
        }
    }

    async addFeedback(userId : string, description : string) {
        try{
            const feedback &#x3D; new FeedbackEntity()
            feedback.user_id &#x3D; userId
            feedback.description &#x3D; description
        
            await feedback.save();
    
        } catch (err) {
            Logger.error(&#x60;Failed to create feedback, userId: ${userId}, error:${err}&#x60;, description);
            const message &#x3D;  await this.i18n.translate(&#x27;message.GENERAL.ERROR.SERVER_ERROR&#x27;, { lang: await userLang(null) })
            const error &#x3D; [{ &quot;AddFeedback&quot; : message }];
            throw new HttpException(await this.response.response(  
                message,
                null, error), HttpStatus.INTERNAL_SERVER_ERROR
            )
        }
    }

    // eslint-disable-next-line @typescript-eslint/ban-types
    async getInterestByUserLabel(user_label):Promise&lt;Object&gt; {
        const data &#x3D; await this.userInterestRepository
        .createQueryBuilder(&quot;interest&quot;)
        .select([&#x27;interest.category_label as label&#x27;])
        .where(&#x27;interest.user_label &#x3D; :userLabel&#x27;, { userLabel: user_label })
        .getRawMany()

        const interests &#x3D; [];

        await data.map(async(interest) &#x3D;&gt; { 
            interests.push(interest.label);
        })

        return interests;
    }

        // eslint-disable-next-line @typescript-eslint/ban-types
    async getExportDataUser(): Promise&lt;Object&gt; {            
            const users &#x3D; await this.userRepository
            .createQueryBuilder(&quot;user&quot;)
            .where(&#x27;user.deleted_at IS NULL&#x27;)
            .leftJoin(UserSubscriptionEntity,&#x27;user_subs&#x27;,&#x27;user_subs.user_label &#x3D; user.user_label&#x27;)
            .leftJoin(SubscriptionPlanEntity, &#x27;plan&#x27;,&#x27;plan.ref_code &#x3D; user_subs.subscription_ref_code&#x27;)
            .select([
                &#x27;user._id as id&#x27;, 
                &#x27;user.firstname as first_name&#x27;, 
                &#x27;user.lastname as last_name&#x27;, 
                &#x27;user.email as email&#x27;,
                &#x27;user.registration_platform as registration_platform&#x27;,
                &#x27;user.last_login_at as last_login_at&#x27;, 
                &#x27;user.referral_code as referral_code&#x27;,
                &#x27;user.member_type as member_type&#x27;,
                &#x27;user.user_label as label&#x27;,
                &#x27;user._created_at as created_at&#x27;,
                &#x60;json_agg(DISTINCT jsonb_build_object(
                    &#x27;user_label&#x27;, user_subs.user_label,
                    &#x27;order_id&#x27;, user_subs.order_id,
                    &#x27;startdate&#x27;, user_subs.startdate,
                    &#x27;enddate&#x27;, user_subs.enddate,
                    &#x27;extra_enddate&#x27;, user_subs.extra_enddate,
                    &#x27;status&#x27;, user_subs.status,
                    &#x27;ref_code&#x27;, user_subs.subscription_ref_code,
                    &#x27;subscription_plan&#x27;, plan.subscription_type,
                    &#x27;created_at&#x27;, user_subs._created_at
                )
            ) AS user_subscriptions&#x60;,
            ])
            .groupBy(
                &#x60;user._id,
                 user.firstname,
                 user.lastname,
                 user.email,
                 user.registration_platform,
                 user.last_login_at,
                 user.referral_code,
                 user.claim_referralcode,
                 user.member_type,
                 user.user_label,
                 user._created_at
            &#x60;)
            .orderBy(&#x27;user._created_at&#x27;, &#x27;ASC&#x27;)
            .getRawMany();
            // return users;
            
            const data &#x3D; [];

            await users.map(async(el) &#x3D;&gt; {
                el.user_subscriptions.sort(function (a, b) {
                    const paramsA &#x3D; new Date(a.enddate).getTime() &gt; new Date(a.extra_enddate).getTime() ? new Date(a.enddate).getTime() : new Date(a.extra_enddate).getTime();
                    const paramsB &#x3D; new Date(b.enddate).getTime() &gt; new Date(b.extra_enddate).getTime() ? new Date(b.enddate).getTime() : new Date(b.extra_enddate).getTime();
                    return paramsB - paramsA;
                  });   

                const user &#x3D; {
                    id: el.id,
                    first_name: el.first_name,
                    last_name: el.last_name,
                    email: el.email,
                    registration_platform : el.registration_platform,
                    last_login_at : el.last_login_at ? moment(el.last_login_at).format(&quot;YYYY-MM-DD HH:mm:ss&quot;) : null,
                    referral_code : el.referral_code,
                    // referral_histories : histories[0].code ? histories : null,
                    member_type : el.member_type,
                    label : el.label,
                    order_id : el.user_subscriptions[0][&#x27;order_id&#x27;] ? &quot;&#x27;&quot; + el.user_subscriptions[0][&#x27;order_id&#x27;] : null,
                    created_at :el.created_at ? moment(el.created_at).format(&quot;YYYY-MM-DD HH:mm:ss&quot;) : null,
                    subscription_status : el.user_subscriptions[0][&#x27;status&#x27;],
                    startdate : el.user_subscriptions[0][&#x27;startdate&#x27;] ? moment(el.user_subscriptions[0][&#x27;startdate&#x27;]).format(&quot;YYYY-MM-DD HH:mm:ss&quot;) : null,
                    enddate : el.user_subscriptions[0][&#x27;enddate&#x27;] ? moment(el.user_subscriptions[0][&#x27;enddate&#x27;]).format(&quot;YYYY-MM-DD HH:mm:ss&quot;) : null,
                    plan : el.user_subscriptions[0][&#x27;subscription_plan&#x27;],
                    extra_enddate : el.user_subscriptions[0][&#x27;extra_enddate&#x27;] ? moment(el.user_subscriptions[0][&#x27;extra_enddate&#x27;]).format(&quot;YYYY-MM-DD HH:mm:ss&quot;) : null,
                }

                data.push(user);
            })

            return data;
    }

    // eslint-disable-next-line @typescript-eslint/ban-types
    async exportCsv(res){
        const fields &#x3D; [
            {
              label: &#x27;Email Address&#x27;,
              value: &#x27;email&#x27;
            },
            {
              label: &#x27;First Name&#x27;,
              value: &#x27;first_name&#x27;
            },
            {
              label: &#x27;Last Name&#x27;,
              value: &#x27;last_name&#x27;
            },
            {
             label: &#x27;Member Type&#x27;,
              value: &#x27;member_type&#x27;
            },
            {
             label: &#x27;User Label&#x27;,
              value: &#x27;label&#x27;
            },
            {
             label: &#x27;Subscription Status&#x27;,
              value: &#x27;subscription_status&#x27;
            },
            {
             label: &#x27;Start Date&#x27;,
              value: &#x27;startdate&#x27;
            },
            {
             label: &#x27;End Date&#x27;,
              value: &#x27;enddate&#x27;
            },
            {
             label: &#x27;Plan&#x27;,
              value: &#x27;plan&#x27;
            },
            {
             label: &#x27;Order ID&#x27;,
              value: &#x27;order_id&#x27;
            },
            {
             label: &#x27;Extra End Date&#x27;,
              value: &#x27;extra_enddate&#x27;
            },
            {
             label: &#x27;Referral Code&#x27;,
              value: &#x27;referral_code&#x27;
            },
            {
             label: &#x27;Registration Platform&#x27;,
              value: &#x27;registration_platform&#x27;
            },
            {
             label: &#x27;Registration Date&#x27;,
              value: &#x27;created_at&#x27;
            },
            {
             label: &#x27;Last Login&#x27;,
              value: &#x27;last_login_at&#x27;
            }
          ];

        const data &#x3D; await this.getExportDataUser();
        const time &#x3D; moment().tz(&#x27;Hongkong&#x27;).format(&#x27;YYYYMMDDHHmmss&#x27;);
        return this.exportFile.csv(res, &#x27;users_&#x27;+time+&#x27;.csv&#x27;, fields, data);
    }

    async isUserUniqueValidationPassed(email : string, username : string):  Promise&lt;any&gt; {
        let user &#x3D; this.userRepository
        .createQueryBuilder(&quot;user&quot;)
        .select([
            &#x27;user._id as id&#x27;, 
            &#x27;user.username as username&#x27;, 
            &#x27;user.email as email&#x27;,
        ])

        if(email) user &#x3D; user.where(&#x27;user.email &#x3D; :email&#x27;, { email })

        if(username) user &#x3D; user.where(&#x27;user.username &#x3D; :username&#x27;, { username })

        const data &#x3D; await user.getRawOne();

        return !data ? true : false;
    }

    async generateReferralCode(check &#x3D; true): Promise&lt;string&gt;{
        let result &#x3D; &#x27;&#x27;;
        const characters       &#x3D; &#x27;ABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789&#x27;;
        const charactersLength &#x3D; characters.length;
        for ( let i &#x3D; 0; i &lt; 6; i++ ) {
           result +&#x3D; characters.charAt(Math.floor(Math.random() * charactersLength));
        }
        if(check){
            Logger.info(&#x60;Checking availability referral code : ${result}&#x60;);
            const isReferralCodeAvailabe &#x3D; await this.isReferralCodeAvailabe(result);
            if(!isReferralCodeAvailabe) {
                    Logger.error(&#x60;Duplicate referral code generated :${result}&#x60;);
                    return this.generateReferralCode();
            } 
        }

        return result;
    }

    async isReferralCodeAvailabe(code : string):  Promise&lt;boolean&gt; {
        const data &#x3D; await this.userRepository
        .createQueryBuilder(&quot;user&quot;)
        .select([
            &#x27;user._id as id&#x27;, 
            &#x27;user.username as username&#x27;, 
            &#x27;user.referral_code as referral_code&#x27;,
        ])
        .where(&#x27;user.referral_code &#x3D; :code&#x27;, { code })
        .getRawOne();

        return !data ? true : false;
    }

    // eslint-disable-next-line @typescript-eslint/ban-types
    async checkUserByReferralCode(referral_code : string, userId : string) : Promise&lt;Object&gt;{
        const data &#x3D; await this.userRepository
        .createQueryBuilder(&quot;user&quot;)
        .select([
            &#x27;user._id as id&#x27;, 
            &#x27;user.firstname as first_name&#x27;, 
            &#x27;user.email as email&#x27;,
            &#x27;user.lastname as last_name&#x27;, 
            &#x27;user.member_type as member_type&#x27;,
            &#x27;user.user_label as user_label&#x27;,
            &#x27;user.referral_code as referral_code&#x27;,
        ])
        .where(&#x27;user.referral_code &#x3D; :referral_code&#x27;, { referral_code })
        .getRawOne();
        
        let valid &#x3D; false;
        let message &#x3D; &#x27;Referral code invalid&#x27;;

        if(data){

            if(data.id !&#x3D; userId){
                const existing_payment &#x3D; await this.getPaidPaymentByUser(userId);
                if(existing_payment.length &gt; 0){
                    message &#x3D; &#x27;Referral code offer is only applicable to new users&#x27;;
                } else {
                    valid &#x3D; true;
                    message &#x3D; &#x27;Referral code is valid&#x27;;
                }
            } else {
                message &#x3D; &#x27;Cannot claim your own referral code&#x27;;
            }
        }

        return {
            valid : valid,
            code : referral_code,
            message : message
        }
    }

    // eslint-disable-next-line @typescript-eslint/ban-types
    async getPaidPaymentByUser(user_id : string): Promise&lt;any&gt; {
        const data &#x3D; await this.userPaymentRepository
        .createQueryBuilder(&#x27;user_payment&#x27;)
        .select([
            &#x27;user_payment._id as id&#x27;, 
            &#x27;user_payment.user_label as user_label&#x27;,
            &#x27;user_payment._owner_id as user_id&#x27;,
            &#x27;user_payment.subscription_ref_code as ref_code&#x27;,
            &#x27;user_payment.paid_fee as paid_fee&#x27;,
            &#x27;user_payment.status as status&#x27;,
            &#x27;user_payment.currency as currency&#x27;,
            &#x27;user_payment.transaction_id as transaction_id&#x27;,
            &#x27;user_payment.original_transaction_id as original_transaction_id&#x27;,
        ])
        .where(&#x27;user_payment._owner_id &#x3D; :user_id&#x27;, { user_id: user_id })  
        .andWhere(&#x27;user_payment.status &#x3D; :status&#x27;, { status: payment_status.PAID })
        .getRawMany();

        return data;
    }

    // async updateFormatReferralCode(){
    //     const users &#x3D; await this.getUser(null, null, null).getRawMany();
    //     // return users;

    //     for await(const user of users){
    //         try {
    //             const code &#x3D; await this.generateReferralCode()
    //             await this.userRepository.update({ _id: user.id }, { referral_code : code});
    //             Logger.info(&#x60;Successfully update user referralcode with id ${user.id} to ${code}&#x60;);
    //         } catch(error){
    //             Logger.error( &#x60;Failed to update user referralcode with id ${user.id}, ${error}&#x60;);
    //             const message &#x3D;  await this.i18n.translate(&#x27;message.GENERAL.ERROR.SERVER_ERROR&#x27;, { lang: await userLang(null) })
    //             const err &#x3D; [{ &quot;update-referral-code&quot; : message }];
    //             throw new HttpException(await this.response.response(  
    //                 message,
    //                 null, err), HttpStatus.INTERNAL_SERVER_ERROR
    //             )
    //         }
    //     }

    //     return &#x27;Done&#x27;;
    // }
}
 </code></pre>
    </div>

</div>













                   </div><div class="search-results">
    <div class="has-results">
        <h1 class="search-results-title"><span class='search-results-count'></span> results matching "<span class='search-query'></span>"</h1>
        <ul class="search-results-list"></ul>
    </div>
    <div class="no-results">
        <h1 class="search-results-title">No results matching "<span class='search-query'></span>"</h1>
    </div>
</div>
</div>
               <!-- END CONTENT -->
           </div>
       </div>

          <label class="dark-mode-switch">
               <input type="checkbox">
               <span class="slider">
                    <svg class="slider-icon" viewBox="0 0 24 24" fill="none" height="20" stroke="#000" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" width="20" xmlns="http://www.w3.org/2000/svg">
                    <path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"></path>
                    </svg>
               </span>
          </label>

       <script>
            var COMPODOC_CURRENT_PAGE_DEPTH = 1;
            var COMPODOC_CURRENT_PAGE_CONTEXT = 'injectable';
            var COMPODOC_CURRENT_PAGE_URL = 'UsersService.html';
            var MAX_SEARCH_RESULTS = 15;
       </script>

       <script src="../js/libs/custom-elements.min.js"></script>
       <script src="../js/libs/lit-html.js"></script>

       <script src="../js/menu-wc.js" defer></script>
       <script nomodule src="../js/menu-wc_es5.js" defer></script>

       <script src="../js/libs/bootstrap-native.js"></script>

       <script src="../js/libs/es6-shim.min.js"></script>
       <script src="../js/libs/EventDispatcher.js"></script>
       <script src="../js/libs/promise.min.js"></script>
       <script src="../js/libs/zepto.min.js"></script>

       <script src="../js/compodoc.js"></script>

       <script src="../js/tabs.js"></script>
       <script src="../js/menu.js"></script>
       <script src="../js/libs/clipboard.min.js"></script>
       <script src="../js/libs/prism.js"></script>
       <script src="../js/sourceCode.js"></script>
          <script src="../js/search/search.js"></script>
          <script src="../js/search/lunr.min.js"></script>
          <script src="../js/search/search-lunr.js"></script>
          <script src="../js/search/search_index.js"></script>
       <script src="../js/lazy-load-graphs.js"></script>


    </body>
</html>
